<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Financeiro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#4b7bec" />
  <link rel="manifest" href="manifest.json" />

  <!-- XLSX (Excel) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>

  <style>
    :root{
      --bg:#f5f5fa;
      --card:#ffffff;
      --primary:#4b7bec;
      --secondary:#20bf6b;
      --accent:#f7b731;
      --text:#222;
      --muted:#666;
      --border:#ddd;
      --danger:#eb3b5a;
      --pill:#eef2ff;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:var(--bg);color:var(--text)}
    main{padding:14px;padding-bottom:90px}

    /* Topo (tarja arredondada) */
    .topbar{
      margin:14px 14px 0 14px;
      background:var(--primary);
      color:#fff;
      border-radius:18px;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
    }
    .topbar h1{font-size:18px;margin:0}
    .chip{
      background:rgba(255,255,255,.18);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:12px;
      margin:10px 0;
      box-shadow:0 2px 8px rgba(0,0,0,.03);
    }
    label{font-size:13px;color:var(--muted)}
    input,select{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      border-radius:12px;
      margin:6px 0 10px 0;
      background:#fff;
      font-size:15px;
    }

    .btn{
      border:none;
      border-radius:12px;
      padding:10px 12px;
      background:var(--primary);
      color:#fff;
      font-weight:600;
    }
    .btn.secondary{background:var(--secondary)}
    .btn.ghost{background:#444}
    .btn.danger{background:var(--danger)}
    .btn.small{padding:8px 10px;border-radius:10px;font-size:13px}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:center;margin:6px 0}
    .big{font-weight:800;font-size:16px}
    .muted{color:var(--muted)}

    /* Pills de banco */
    .pillbar{display:flex;gap:8px;background:var(--pill);padding:8px;border-radius:999px}
    .pill{
      flex:1;
      border:none;
      border-radius:999px;
      padding:10px 12px;
      font-weight:700;
      background:transparent;
      color:var(--primary);
    }
    .pill.active{background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .hint{font-size:12px;color:var(--muted);margin-top:4px}

    /* Abas (footer) */
    nav{
      position:fixed;left:0;right:0;bottom:0;
      background:#fff;border-top:1px solid var(--border);
      display:flex;gap:4px;padding:8px;
    }
    nav button{
      flex:1;border:none;border-radius:14px;padding:10px 6px;
      background:#fff;color:var(--muted);font-weight:700;
    }
    nav button.active{
      background:var(--pill);
      color:var(--primary);
    }

    .view{display:none}
    .view.active{display:block}

    /* lista lan√ßamentos */
    .item{
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px;
      margin:8px 0;
      background:#fff;
    }
    .tag{
      font-size:12px;
      background:var(--pill);
      padding:4px 8px;border-radius:999px;
      color:var(--primary);
      font-weight:700;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <h1>Financeiro</h1>
    <div class="chip" id="chip-month">‚Äî</div>
  </div>

  <main>
    <!-- LAN√áAR -->
    <section id="view-lancar" class="view active">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Novo lan√ßamento</h3>

        <label>Conta</label>
        <select id="conta">
          <option>Bradesco</option>
          <option>Banco do Brasil</option>
          <option>Cart√£o</option>
        </select>

        <label>Tipo</label>
        <select id="tipo">
          <option>Despesa</option>
          <option>Receita</option>
          <option>Transfer√™ncia</option>
        </select>

        <label>Categoria</label>
        <select id="categoria"></select>

        <label>Subcategoria</label>
        <select id="subcategoria"></select>

        <label>Valor</label>
        <input id="valor" type="number" step="0.01" />

        <label>Compet√™ncia</label>
        <input id="competencia" type="month" />

        <label>Descri√ß√£o</label>
        <input id="descricao" placeholder="Ex.: mercado, uber, aporte..." />

        <button class="btn secondary" onclick="salvarLancamento()">Salvar</button>
        <div class="hint">Dica: voc√™ edita/exclui depois na tela ‚ÄúM√™s‚Äù.</div>
      </div>
    </section>

    <!-- M√äS -->
    <section id="view-mes" class="view">
      <div class="card">
        <div class="row">
          <div style="flex:1">
            <label>M√™s (compet√™ncia)</label>
            <input id="dash-month" type="month" />
          </div>
        </div>

        <div class="pillbar" style="margin-top:6px">
          <button id="pill-brad" class="pill active">Bradesco</button>
          <button id="pill-bb" class="pill">BB</button>
        </div>
        <div class="hint">Alternar banco muda o resumo e a lista.</div>
      </div>

      <div id="dashboard" class="card"></div>
      <div id="listagem" class="card"></div>
    </section>

    <!-- CART√ÉO -->
    <section id="view-cartao" class="view">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Cart√£o</h3>

        <label>M√™s (compet√™ncia)</label>
        <input id="card-month" type="month" />

        <div class="row">
          <button class="btn small" id="btn-add-sub">+ Assinatura</button>
          <button class="btn small ghost" id="btn-sync-subs">Gerar m√™s</button>
        </div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Cadastro de assinaturas</h4>
        <div id="subs-master-list"></div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Fatura do m√™s</h4>
        <div id="card-list"></div>
      </div>
    </section>

    <!-- INVEST -->
    <section id="view-invest" class="view">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Investimentos (BB)</h3>
        <div id="invest-view"></div>
      </div>
    </section>

    <!-- MAIS -->
    <section id="view-mais" class="view">
      <div class="card">
        <h3 style="margin:0 0 8px 0">Mais</h3>
        <button class="btn" onclick="exportExcel()">üì§ Exportar Excel (m√™s)</button>
        <div class="hint">Se n√£o baixar, provavelmente √© cache antigo do GitHub Pages.</div>
      </div>

      <div class="card">
        <h4 style="margin:0 0 8px 0">Categorias & Subcategorias</h4>
        <button class="btn small" onclick="openCatsManager()">Gerenciar</button>
        <div id="cats-preview" class="hint"></div>
      </div>
    </section>
  </main>

  <nav>
    <button id="tab-lancar" class="active" onclick="showView('lancar')">+ Lan√ßar</button>
    <button id="tab-mes" onclick="showView('mes')">M√™s</button>
    <button id="tab-cartao" onclick="showView('cartao')">Cart√£o</button>
    <button id="tab-invest" onclick="showView('invest')">Invest</button>
    <button id="tab-mais" onclick="showView('mais')">Mais</button>
  </nav>

  <script src="storage.js"></script>
  <script src="app.js"></script>

  <script>
    if ("serviceWorker" in navigator) navigator.serviceWorker.register("sw.js");
  </script>
</body>
</html>